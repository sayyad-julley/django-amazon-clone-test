{% extends 'admin_templates/base_template.html' %}
{% block title %}
Product Create
{% endblock title %}

{% block custom_css %}
<link rel="stylesheet" href="//bootstrap-tagsinput.github.io/bootstrap-tagsinput/dist/bootstrap-tagsinput.css"/>
<style>
.bootstrap-tagsinput{
width:100%;
}
</style>
{% endblock custom_css %}

{% block page_title %}
Product Create
{% endblock page_title %}

{% block page_content %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <h4>Product Create</h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="form-group">
                            <label>{{ field.label }}{% if field.field.required %} <span style="color: red;">*</span>{% endif %}</label>
                            {% if field.field.widget.input_type == 'textarea' %}

                                <textarea class="form-control char-count-input" name="{{ field.name }}" id="{{ field.name }}" maxlength="500">{{ field.value|default_if_none:"" }}</textarea>
                                <small class="text-muted">Character count: <span id="{{ field.name }}-charCount">0</span>/500</small>

                            {% elif field.field.widget.input_type == 'select' %}
                                <select name="{{ field.name }}" class="form-control">
                                    {% for choice in field.field.choices %}
                                        <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>{{ choice.1 }}</option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" id="{{ field.name }}" class="form-control" value="{{ field.value|default_if_none:"" }}">
                                {% if field.name == 'product_name' %}
                                <small class="form-text text-muted">Enter the full product name as it should appear to customers</small>
                                {% endif %}
                                {% if field.name == 'brand' %}
                                <small class="form-text text-muted">Enter the manufacturer or brand name</small>
                                {% endif %}
                            {% endif %}
                            {% if field.errors %}
                            <div class="alert alert-danger" style="margin:10px">
                                {{ field.errors }}
                            </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    <div class="row">
                        <div class="col-lg-6">
                            <a href="{% url 'product_list' %}" class="btn btn-secondary btn-block">&larr; Back to Product List</a>
                        </div>
                        <div class="col-lg-6">
                            <button type="submit" class="btn btn-primary btn-block">ADD PRODUCT</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock page_content %}

{% block custom_js %}
<script src="//cdn.tiny.cloud/1/u6oa5pnpaa1vxho1md7uk4zmq2ai7xuf5o5wfgyrc131vpj6/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script>
  tinymce.init({
    selector: "textarea[name='product_long_description']",
    height: 300,
    plugins: [
        "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
        "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime nonbreaking",
        "save table contextmenu directionality emoticons template paste textcolor",
    ],
    images_upload_url:"{% url 'file_upload' %}",
    toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
    automatic_uploads: true,
    file_picker_types: 'image',
    file_picker_callback: function (cb, value, meta) {
        var input = document.createElement('input');
        input.setAttribute('type', 'file');
        input.setAttribute('accept', 'image/*');
        input.onchange = function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.onload = function () {
                var id = 'blobid' + (new Date()).getTime();
                var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
                var base64 = reader.result.split(',')[1];
                var blobInfo = blobCache.create(id, file, base64);
                blobCache.add(blobInfo);
                cb(blobInfo.blobUri(), { title: file.name });
            };
            reader.readAsDataURL(file);
        };
        input.click();
    },
});

// Character count functionality
document.addEventListener('DOMContentLoaded', function() {
    const charCountInputs = document.querySelectorAll('.char-count-input');
    charCountInputs.forEach(function(input) {
        const charCountSpan = document.getElementById(input.id + '-charCount');

        input.addEventListener('input', function() {
            charCountSpan.textContent = this.value.length;
        });

        // Initialize count on page load
        charCountSpan.textContent = input.value.length;
    });
});

</script>
<script src="//bootstrap-tagsinput.github.io/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>
{% endblock custom_js %}